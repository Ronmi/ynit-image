FROM debian:%tag%
MAINTAINER Ronmi Ren <ronmi@patrolavia.com>

ENV YNITVER v0.1
ENV GOVER 1.6

RUN export deps="git wget ca-certificates" \
 && export GOPATH="/gopath" \
 && export GOROOT="/go" \
 && export YNITDIR="$GOPATH/src/github.com/Ronmi/ynit" \
 && apt-get update \
 && apt-get install -y --no-install-recommends $deps \
 && mkdir -p $GOPATH $GOROOT \
 && wget -q -O - https://storage.googleapis.com/golang/go$GOVER.linux-amd64.tar.gz | tar zxf - \
 && mkdir -p $YNITDIR \
 && git clone -b $YNITVER https://github.com/Ronmi/ynit $YNITDIR \
 && (cd $YNITDIR && $GOROOT/bin/go get && $GOROOT/bin/go build && cp $YNITDIR/ynit /usr/local/bin/) \
 && apt-get purge -y $deps libsasl2-2 libsasl2-modules \
 && apt-get autoremove --purge -y \
 && apt-get clean \
 && rm -fr /var/lib/apt/lists/* $GOPATH $GOROOT

CMD ["/usr/local/bin/ynit"]
